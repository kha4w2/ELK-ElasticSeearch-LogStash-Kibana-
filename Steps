# ðŸ“˜ Building a Complete Windows-to-ELK Logging Pipeline

### *Winlogbeat â†’ Logstash â†’ Elasticsearch â†’ Kibana*

**ENG. Khaled Sherif Elgohary**\
**Date: 25/10/2025**

------------------------------------------------------------------------

## From 1 TO 3:

### **Winlogbeat â†’ Elasticsearch â†’ Kibana**

------------------------------------------------------------------------

# 1. Installing Elasticsearch on Ubuntu (Debian Package Method)

### âž¤ Update & Upgrade System Packages

To make sure all system packages are up to date before installing
Elasticsearch, preventing dependency or version conflicts.\
**Command:**

    sudo apt update && sudo apt upgrade -y

### âž¤ Import Elasticsearch PGP Key

Ensures authenticity of Elasticsearch packages.\
**Command:**

    wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo gpg --dearmor -o /usr/share/keyrings/elasticsearch-keyring.gpg

### âž¤ Install apt-transport-https

**Command:**

    sudo apt-get install apt-transport-https

### âž¤ Add Elasticsearch 9.x Repository

**Command:**

    echo "deb [signed-by=/usr/share/keyrings/elasticsearch-keyring.gpg] https://artifacts.elastic.co/packages/9.x/apt stable main" | sudo tee /etc/apt/sources.list.d/elastic-9.x.list

### âž¤ Update Package Index & Install Elasticsearch

    sudo apt-get update && sudo apt-get install elasticsearch -y

### âž¤ Reload Systemd & Start Elasticsearch

    sudo systemctl daemon-reload
    sudo systemctl start elasticsearch.service
    sudo systemctl status elasticsearch.service

### âž¤ Download Elasticsearch Debian Package

    wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-9.2.1-amd64.deb

### âž¤ Download SHA-512 Checksum

    wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-9.2.1-amd64.deb.sha512

### âž¤ Verify Package Integrity & Install

    shasum -a 512 -c elasticsearch-9.2.1-amd64.deb.sha512
    sudo dpkg -i elasticsearch-9.2.1-amd64.deb

### âž¤ Edit elasticsearch.yml

    sudo nano /etc/elasticsearch/elasticsearch.yml

### âž¤ Enable & Start Elasticsearch

    sudo systemctl daemon-reload
    sudo systemctl enable elasticsearch.service
    sudo systemctl start elasticsearch.service
    sudo systemctl restart elasticsearch.service
    sudo systemctl status elasticsearch.service

### âž¤ Reset elastic User Password

    sudo /usr/share/elasticsearch/bin/elasticsearch-reset-password -u elastic

### âž¤ Install curl

    sudo apt install curl -y

### âž¤ Verify Elasticsearch

    curl -k -u elastic:"20LkA230BLj04hLkUmFK" https://localhost:9200

------------------------------------------------------------------------

# 2. Installing Kibana on Ubuntu

### âž¤ Import GPG Key, HTTPS Transport, Add Repo

    wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo gpg --dearmor -o /usr/share/keyrings/elasticsearch-keyring.gpg
    sudo apt-get install apt-transport-https -y
    echo "deb [signed-by=/usr/share/keyrings/elasticsearch-keyring.gpg] https://artifacts.elastic.co/packages/9.x/apt stable main" | sudo tee /etc/apt/sources.list.d/elastic-9.x.list

### âž¤ Install Kibana

    sudo apt-get update && sudo apt-get install kibana -y

### âž¤ Create Enrollment Token

    sudo /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana

### âž¤ Start & Check Kibana

    sudo systemctl start kibana
    sudo systemctl status kibana

### âž¤ Apply Enrollment Token

Linked Kibana securely to Elasticsearch.

### âž¤ Login with username/password

Kibana now fully connected.

------------------------------------------------------------------------

# 3. Installing Winlogbeat on Windows 10 VM

### âž¤ Download Winlogbeat ZIP

Obtain required package.

### âž¤ Extract ZIP

    cd "C:\Users\Khaled\Downloads"
    Expand-Archive ".\winlogbeat-9.2.1-windows-x86_64.zip" -DestinationPath "C:\Program Files\Winlogbeat"

### âž¤ Navigate to Installation Directory

    cd "C:\Program Files\Winlogbeat"
    ls

### âž¤ Install Winlogbeat Service

    Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
    .\install-service-winlogbeat.ps1

### âž¤ Verify Service Status

    Get-Service winlogbeat

### âž¤ Configure winlogbeat.yml

Set Elasticsearch + Kibana output.

### âž¤ Validate Configuration

    .\winlogbeat.exe test config -c .\winlogbeat.yml -e

### âž¤ Run Setup

Loads dashboards/templates.

### âž¤ Start & Verify Service

    Start-Service winlogbeat
    Get-Service winlogbeat
    services.msc

### âž¤ Verify Index in Kibana

Check winlogbeat-\* index.

------------------------------------------------------------------------

# 4. Building Full Log Pipeline

### **Winlogbeat â†’ Logstash â†’ Elasticsearch â†’ Kibana**

### âž¤ Add Elastic APT Repo

    wget -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo gpg --dearmor -o /usr/share/keyrings/elastic-keyring.gpg
    sudo apt-get install apt-transport-https
    echo "deb [signed-by=/usr/share/keyrings/elastic-keyring.gpg] https://artifacts.elastic.co/packages/9.x/apt stable main" | sudo tee -a /etc/apt/sources.list.d/elastic-9.x.list

### âž¤ Update APT

    sudo apt update

### âž¤ Install Logstash

    sudo apt install logstash -y

### âž¤ Start & Verify Logstash

    sudo systemctl start logstash
    sudo systemctl status logstash

### âž¤ Understand Logstash Config

    cat /etc/logstash/logstash-sample.conf

### âž¤ Create Pipeline Config

    cd /etc/logstash/conf.d
    sudo nano winlogbeat.conf

### âž¤ Restart & Verify Logstash

    sudo systemctl restart logstash
    sudo systemctl status logstash

### âž¤ Fix Logstash Permissions

    sudo chown -R logstash:logstash /usr/share/logstash/data
    sudo chmod -R 750 /usr/share/logstash/data

### âž¤ Validate Logstash Config

    sudo -u logstash /usr/share/logstash/bin/logstash --path.settings /etc/logstash -t

### âž¤ Monitor Logstash Logs

    sudo journalctl -u logstash -f

### âž¤ Configure Winlogbeat to Logstash

Setup HTTPS forwarding.

### âž¤ Configure Winlogbeat to Elasticsearch

Secure connection and indexing.

### âž¤ Firewall Rule for Winlogbeat

    New-NetFirewallRule -DisplayName "Allow Winlogbeat to Logstash" -Direction Inbound -Protocol TCP -LocalPort 5044 -Action Allow

### âž¤ Validate Winlogbeat Before Start

    Restart-Service winlogbeat
    .\winlogbeat.exe test config -c .\winlogbeat.yml -e

### âž¤ Test Winlogbeat Output

    .\winlogbeat.exe test output -c winlogbeat.yml

### âž¤ Verify Service in Windows

    services.msc

### âž¤ Restart & Verify Elasticsearch

    sudo systemctl restart elasticsearch
    sudo systemctl status elasticsearch
    curl -X GET "localhost:9200/?pretty"

### âž¤ Verify Winlogbeat Index in Elasticsearch

    curl -X GET -u elastic:CalEunKfLKYKBm7-Me62 "https://localhost:9200/.ds-winlogbeat-9.2.1-2025.11.21-000001?pretty" -k

### âž¤ Final Elasticsearch Status

    curl -k -u elastic:FYQEm=bUNr-6yUeyfdiC https://192.168.6.130:9200
    curl -k -u elastic:FYQEm=bUNr-6yUeyfdiC "https://192.168.6.130:9200/winlogbeat*/_search?pretty&size=5"

------------------------------------------------------------------------

ðŸŽ‰ **Full Pipeline Documented Successfully!**
